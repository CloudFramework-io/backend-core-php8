<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataMongoDB Class - CloudFramework Backend Core PHP8</title>
    <meta name="description" content="DataMongoDB Class - CloudFramework Backend Core PHP8 API Reference">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>CloudFramework Backend Core PHP8</h1>
        <span class="version">v8.4+</span>
    </header>

    <!-- Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-search">
                <input type="text" id="search-input" placeholder="Search documentation...">
            </div>

            <nav class="sidebar-nav">
                <!-- Getting Started -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Getting Started</div>
                    <ul>
                        <li><a href="../index.html" class="sidebar-nav-link">Documentation Home</a></li>
                        <li><a href="../guides/getting-started.html" class="sidebar-nav-link">Installation & Setup</a></li>
                        <li><a href="../guides/getting-started.html#quick-start" class="sidebar-nav-link">Quick Start</a></li>
                    </ul>
                </div>

                <!-- Development Guides -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Development Guides</div>
                    <ul>
                        <li><a href="../guides/api-development.html" class="sidebar-nav-link">API Development</a></li>
                        <li><a href="../guides/script-development.html" class="sidebar-nav-link">Script Development</a></li>
                        <li><a href="../guides/configuration.html" class="sidebar-nav-link">Configuration</a></li>
                        <li><a href="../guides/deployment.html" class="sidebar-nav-link">Deployment</a></li>
                    </ul>
                </div>

                <!-- GCP Integration -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">GCP Integration</div>
                    <ul>
                        <li><a href="../guides/gcp-integration.html" class="sidebar-nav-link">GCP Overview</a></li>
                        <li><a href="../guides/security.html" class="sidebar-nav-link">Security</a></li>
                        <li><a href="../guides/testing.html" class="sidebar-nav-link">Testing</a></li>
                    </ul>
                </div>

                <!-- Core Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Core Classes</div>
                    <ul>
                        <li><a href="Core7.html" class="sidebar-nav-link">Core7</a></li>
                        <li><a href="RESTful.html" class="sidebar-nav-link">RESTful</a></li>
                        <li><a href="Scripts2020.html" class="sidebar-nav-link">Scripts2020</a></li>
                    </ul>
                </div>

                <!-- Configuration Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Configuration</div>
                    <ul>
                        <li><a href="CoreConfig.html" class="sidebar-nav-link">CoreConfig</a></li>
                        <li><a href="CoreCache.html" class="sidebar-nav-link">CoreCache</a></li>
                        <li><a href="CoreSession.html" class="sidebar-nav-link">CoreSession</a></li>
                        <li><a href="CoreSecurity.html" class="sidebar-nav-link">CoreSecurity</a></li>
                    </ul>
                </div>

                <!-- Data Access Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Data Access</div>
                    <ul>
                        <li><a href="DataStore.html" class="sidebar-nav-link">DataStore</a></li>
                        <li><a href="Buckets.html" class="sidebar-nav-link">Buckets</a></li>
                        <li><a href="DataBQ.html" class="sidebar-nav-link">DataBQ</a></li>
                        <li><a href="CloudSQL.html" class="sidebar-nav-link">CloudSQL</a></li>
                        <li><a href="DataSQL.html" class="sidebar-nav-link">DataSQL</a></li>
                        <li><a href="DataMongoDB.html" class="sidebar-nav-link active">DataMongoDB</a></li>
                    </ul>
                </div>

                <!-- Utilities -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Utilities</div>
                    <ul>
                        <li><a href="Email.html" class="sidebar-nav-link">Email</a></li>
                        <li><a href="DataValidation.html" class="sidebar-nav-link">DataValidation</a></li>
                        <li><a href="WorkFlows.html" class="sidebar-nav-link">WorkFlows</a></li>
                        <li><a href="GoogleSecrets.html" class="sidebar-nav-link">GoogleSecrets</a></li>
                        <li><a href="PubSub.html" class="sidebar-nav-link">PubSub</a></li>
                    </ul>
                </div>

                <!-- Examples -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Examples</div>
                    <ul>
                        <li><a href="../examples/api-examples.html" class="sidebar-nav-link">API Examples</a></li>
                        <li><a href="../examples/script-examples.html" class="sidebar-nav-link">Script Examples</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
<h1>DataMongoDB Class</h1>

<h2>Overview</h2>

The <code>DataMongoDB</code> class provides integration with MongoDB for NoSQL document storage. It offers methods for connecting to MongoDB, performing CRUD operations, and querying collections.

<h2>Loading the Class</h2>

<pre><code class="language-php">$mongo = $this->core->loadClass('DataMongoDB');
</code></pre>

<h2>Properties</h2>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$core</code></td>
<td>Core7</td>
<td>Reference to Core7 instance</td>
</tr>
<tr>
<td><code>$error</code></td>
<td>bool</td>
<td>Error flag</td>
</tr>
<tr>
<td><code>$errorMsg</code></td>
<td>array</td>
<td>Error messages</td>
</tr>
<tr>
<td><code>$connection</code></td>
<td>MongoDB\Client</td>
<td>MongoDB client connection</td>
</tr>
<tr>
<td><code>$db</code></td>
<td>MongoDB\Database</td>
<td>Current database</td>
</tr>
<tr>
<td><code>$collection</code></td>
<td>MongoDB\Collection</td>
<td>Current collection</td>
</tr>
</tbody>
</table>

<p>---</p>

<h2>Connection Methods</h2>

<h3>connect()</h3>

<pre><code class="language-php">public function connect($uri, $dbName): bool
</code></pre>

<p>Connects to MongoDB.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$uri</code> (string): MongoDB connection URI</li>
<li><code>$dbName</code> (string): Database name</li>
</ul>

<strong>Returns:</strong> <code>true</code> on success

<strong>Example:</strong>
<pre><code class="language-php">$mongo = $this->core->loadClass('DataMongoDB');
$connected = $mongo->connect('mongodb://localhost:27017', 'myapp');

if(!$connected) {
    // Handle connection error
}
</code></pre>

<p>---</p>

<h3>selectCollection()</h3>

<pre><code class="language-php">public function selectCollection($collectionName): void
</code></pre>

<p>Selects a collection to work with.</p>

<strong>Example:</strong>
<pre><code class="language-php">$mongo->selectCollection('users');
</code></pre>

<p>---</p>

<h2>CRUD Operations</h2>

<h3>insert()</h3>

<pre><code class="language-php">public function insert($document): string|false
</code></pre>

<p>Inserts a document into the collection.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$document</code> (array): Document to insert</li>
</ul>

<strong>Returns:</strong> Inserted document ID, or <code>false</code> on error

<strong>Example:</strong>
<pre><code class="language-php">$mongo->selectCollection('users');
$userId = $mongo->insert([
    'name' => 'John Doe',
    'email' => 'john@example.com',
    'created_at' => new MongoDB\BSON\UTCDateTime()
]);
</code></pre>

<p>---</p>

<h3>find()</h3>

<pre><code class="language-php">public function find($filter = [], $options = []): array
</code></pre>

<p>Finds documents matching filter.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$filter</code> (array): Query filter</li>
<li><code>$options</code> (array): Query options (limit, sort, projection)</li>
</ul>

<strong>Returns:</strong> Array of documents

<strong>Example:</strong>
<pre><code class="language-php">// Find all active users
$users = $mongo->find(['status' => 'active']);

// Find with options
$users = $mongo->find(
    ['age' => ['$gte' => 18]],
    ['limit' => 10, 'sort' => ['name' => 1]]
);

// Find with projection
$users = $mongo->find(
    ['status' => 'active'],
    ['projection' => ['name' => 1, 'email' => 1]]
);
</code></pre>

<p>---</p>

<h3>findOne()</h3>

<pre><code class="language-php">public function findOne($filter = [], $options = []): array|null
</code></pre>

<p>Finds a single document.</p>

<strong>Example:</strong>
<pre><code class="language-php">$user = $mongo->findOne(['email' => 'john@example.com']);
</code></pre>

<p>---</p>

<h3>update()</h3>

<pre><code class="language-php">public function update($filter, $update, $options = []): int
</code></pre>

<p>Updates documents matching filter.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$filter</code> (array): Query filter</li>
<li><code>$update</code> (array): Update operations</li>
<li><code>$options</code> (array): Update options</li>
</ul>

<strong>Returns:</strong> Number of modified documents

<strong>Example:</strong>
<pre><code class="language-php">// Update single document
$mongo->update(
    ['email' => 'john@example.com'],
    ['$set' => ['status' => 'verified']]
);

// Update multiple
$mongo->update(
    ['status' => 'pending'],
    ['$set' => ['status' => 'active']],
    ['multi' => true]
);
</code></pre>

<p>---</p>

<h3>delete()</h3>

<pre><code class="language-php">public function delete($filter): int
</code></pre>

<p>Deletes documents matching filter.</p>

<strong>Returns:</strong> Number of deleted documents

<strong>Example:</strong>
<pre><code class="language-php">// Delete single document
$deleted = $mongo->delete(['email' => 'john@example.com']);

// Delete multiple
$deleted = $mongo->delete(['status' => 'inactive']);
</code></pre>

<p>---</p>

<h3>count()</h3>

<pre><code class="language-php">public function count($filter = []): int
</code></pre>

<p>Counts documents matching filter.</p>

<strong>Example:</strong>
<pre><code class="language-php">$activeUsers = $mongo->count(['status' => 'active']);
</code></pre>

<p>---</p>

<h2>Common Usage Patterns</h2>

<h3>User Management</h3>

<pre><code class="language-php">class API extends RESTful
{
    private $mongo;

    function main()
    {
        $this->mongo = $this->core->loadClass('DataMongoDB');
        $this->mongo->connect('mongodb://localhost:27017', 'myapp');
        $this->mongo->selectCollection('users');

        if(!$this->useFunction('ENDPOINT_' . ($this->params[0] ?? 'list'))) {
            return $this->setErrorFromCodelib('params-error', 'Endpoint not found');
        }
    }

    public function ENDPOINT_create()
    {
        if(!$this->checkMethod('POST')) return;

        $userId = $this->mongo->insert([
            'name' => $this->formParams['name'],
            'email' => $this->formParams['email'],
            'status' => 'active',
            'created_at' => new MongoDB\BSON\UTCDateTime()
        ]);

        $this->addReturnData(['user_id' => $userId]);
    }

    public function ENDPOINT_list()
    {
        $users = $this->mongo->find(
            ['status' => 'active'],
            ['limit' => 50, 'sort' => ['created_at' => -1]]
        );

        $this->addReturnData($users);
    }

    public function ENDPOINT_get()
    {
        $userId = $this->params[1] ?? null;

        $user = $this->mongo->findOne(['_id' => new MongoDB\BSON\ObjectId($userId)]);

        if($user) {
            $this->addReturnData($user);
        } else {
            return $this->setErrorFromCodelib('not-found', 'User not found');
        }
    }

    public function ENDPOINT_update()
    {
        if(!$this->checkMethod('PUT')) return;

        $userId = $this->params[1] ?? null;

        $this->mongo->update(
            ['_id' => new MongoDB\BSON\ObjectId($userId)],
            ['$set' => [
                'name' => $this->formParams['name'],
                'email' => $this->formParams['email'],
                'updated_at' => new MongoDB\BSON\UTCDateTime()
            ]]
        );

        $this->addReturnData(['status' => 'updated']);
    }

    public function ENDPOINT_delete()
    {
        if(!$this->checkMethod('DELETE')) return;

        $userId = $this->params[1] ?? null;

        $this->mongo->delete(['_id' => new MongoDB\BSON\ObjectId($userId)]);

        $this->addReturnData(['status' => 'deleted']);
    }
}
</code></pre>

<h3>Search and Filter</h3>

<pre><code class="language-php">// Complex queries
$users = $mongo->find([
    'age' => ['$gte' => 18, '$lte' => 65],
    'status' => 'active',
    '$or' => [
        ['city' => 'New York'],
        ['city' => 'Los Angeles']
    ]
]);

// Text search
$results = $mongo->find([
    '$text' => ['$search' => 'developer']
]);

// Array contains
$users = $mongo->find([
    'tags' => ['$in' => ['premium', 'vip']]
]);
</code></pre>

<h3>Aggregation</h3>

<pre><code class="language-php">$pipeline = [
    ['$match' => ['status' => 'active']],
    ['$group' => [
        '_id' => '$city',
        'count' => ['$sum' => 1],
        'avg_age' => ['$avg' => '$age']
    ]],
    ['$sort' => ['count' => -1]]
];

$results = $mongo->aggregate($pipeline);
</code></pre>

<p>---</p>

<h2>MongoDB Operators</h2>

<h3>Comparison</h3>

<ul>
<li><code>$eq</code> - Equal</li>
<li><code>$ne</code> - Not equal</li>
<li><code>$gt</code> - Greater than</li>
<li><code>$gte</code> - Greater than or equal</li>
<li><code>$lt</code> - Less than</li>
<li><code>$lte</code> - Less than or equal</li>
<li><code>$in</code> - In array</li>
<li><code>$nin</code> - Not in array</li>
</ul>

<h3>Logical</h3>

<ul>
<li><code>$and</code> - Logical AND</li>
<li><code>$or</code> - Logical OR</li>
<li><code>$not</code> - Logical NOT</li>
<li><code>$nor</code> - Logical NOR</li>
</ul>

<h3>Update</h3>

<ul>
<li><code>$set</code> - Set field value</li>
<li><code>$unset</code> - Remove field</li>
<li><code>$inc</code> - Increment value</li>
<li><code>$push</code> - Add to array</li>
<li><code>$pull</code> - Remove from array</li>
</ul>

<p>---</p>

<h2>See Also</h2>

<ul>
<li><a href="DataStore.html">DataStore Class Reference</a></li>
<li><a href="Core7.html">Core7 Class Reference</a></li>
<li><a href="../guides/api-development.html">API Development Guide</a></li>
</ul>

        </main>
    </div>

    <script src="../js/main.js"></script>
</body>
</html>