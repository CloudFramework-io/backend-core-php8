<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core7 Class - CloudFramework Backend Core PHP8</title>
    <meta name="description" content="Core7 Class - CloudFramework Backend Core PHP8 API Reference">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>CloudFramework Backend Core PHP8</h1>
        <span class="version">v8.4+</span>
    </header>

    <!-- Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-search">
                <input type="text" id="search-input" placeholder="Search documentation...">
            </div>

            <nav class="sidebar-nav">
                <!-- Getting Started -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Getting Started</div>
                    <ul>
                        <li><a href="../index.html" class="sidebar-nav-link">Documentation Home</a></li>
                        <li><a href="../guides/getting-started.html" class="sidebar-nav-link">Installation & Setup</a></li>
                        <li><a href="../guides/getting-started.html#quick-start" class="sidebar-nav-link">Quick Start</a></li>
                    </ul>
                </div>

                <!-- Development Guides -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Development Guides</div>
                    <ul>
                        <li><a href="../guides/api-development.html" class="sidebar-nav-link">API Development</a></li>
                        <li><a href="../guides/script-development.html" class="sidebar-nav-link">Script Development</a></li>
                        <li><a href="../guides/configuration.html" class="sidebar-nav-link">Configuration</a></li>
                        <li><a href="../guides/deployment.html" class="sidebar-nav-link">Deployment</a></li>
                    </ul>
                </div>

                <!-- GCP Integration -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">GCP Integration</div>
                    <ul>
                        <li><a href="../guides/gcp-integration.html" class="sidebar-nav-link">GCP Overview</a></li>
                        <li><a href="../guides/security.html" class="sidebar-nav-link">Security</a></li>
                        <li><a href="../guides/testing.html" class="sidebar-nav-link">Testing</a></li>
                    </ul>
                </div>

                <!-- Core Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Core Classes</div>
                    <ul>
                        <li><a href="Core7.html" class="sidebar-nav-link active">Core7</a></li>
                        <li><a href="RESTful.html" class="sidebar-nav-link">RESTful</a></li>
                        <li><a href="Scripts2020.html" class="sidebar-nav-link">Scripts2020</a></li>
                    </ul>
                </div>

                <!-- Configuration Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Configuration</div>
                    <ul>
                        <li><a href="CoreConfig.html" class="sidebar-nav-link">CoreConfig</a></li>
                        <li><a href="CoreCache.html" class="sidebar-nav-link">CoreCache</a></li>
                        <li><a href="CoreSession.html" class="sidebar-nav-link">CoreSession</a></li>
                        <li><a href="CoreSecurity.html" class="sidebar-nav-link">CoreSecurity</a></li>
                    </ul>
                </div>

                <!-- Data Access Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Data Access</div>
                    <ul>
                        <li><a href="DataStore.html" class="sidebar-nav-link">DataStore</a></li>
                        <li><a href="Buckets.html" class="sidebar-nav-link">Buckets</a></li>
                        <li><a href="DataBQ.html" class="sidebar-nav-link">DataBQ</a></li>
                        <li><a href="CloudSQL.html" class="sidebar-nav-link">CloudSQL</a></li>
                        <li><a href="DataSQL.html" class="sidebar-nav-link">DataSQL</a></li>
                        <li><a href="DataMongoDB.html" class="sidebar-nav-link">DataMongoDB</a></li>
                    </ul>
                </div>

                <!-- Utilities -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Utilities</div>
                    <ul>
                        <li><a href="Email.html" class="sidebar-nav-link">Email</a></li>
                        <li><a href="DataValidation.html" class="sidebar-nav-link">DataValidation</a></li>
                        <li><a href="WorkFlows.html" class="sidebar-nav-link">WorkFlows</a></li>
                        <li><a href="GoogleSecrets.html" class="sidebar-nav-link">GoogleSecrets</a></li>
                        <li><a href="PubSub.html" class="sidebar-nav-link">PubSub</a></li>
                    </ul>
                </div>

                <!-- Examples -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Examples</div>
                    <ul>
                        <li><a href="../examples/api-examples.html" class="sidebar-nav-link">API Examples</a></li>
                        <li><a href="../examples/script-examples.html" class="sidebar-nav-link">Script Examples</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
<h1>Core7 Class</h1>

<h2>Overview</h2>

The <code>Core7</code> class is the main framework class that provides access to all core functionality and services. It is automatically available in your APIs and scripts through <code>$this->core</code> and includes multiple sub-classes for different purposes.

<h2>Accessing Core7</h2>

In your APIs and scripts, Core7 is available as <code>$this->core</code>:

<pre><code class="language-php">// In your API
class API extends RESTful
{
    function main()
    {
        // Access Core7 and its sub-classes
        $this->core->logs->add('API called');
        $config = $this->core->config->get('my_setting');
        $cached = $this->core->cache->get('my_key');

        // Load external classes
        $ds = $this->core->loadClass('DataStore', ['Users']);
    }
}
</code></pre>

<h2>Core7 Sub-Classes</h2>

Core7 initializes and provides access to multiple sub-classes:

<table>
<thead>
<tr>
<th>Property</th>
<th>Class</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$this->core->__p</code></td>
<td><a href="#coreperformance">CorePerformance</a></td>
<td>Performance monitoring</td>
</tr>
<tr>
<td><code>$this->core->is</code></td>
<td><a href="#coreis">CoreIs</a></td>
<td>Environment detection</td>
</tr>
<tr>
<td><code>$this->core->system</code></td>
<td><a href="#coresystem">CoreSystem</a></td>
<td>System information</td>
</tr>
<tr>
<td><code>$this->core->logs</code></td>
<td><a href="#corelog">CoreLog</a></td>
<td>Logging system</td>
</tr>
<tr>
<td><code>$this->core->errors</code></td>
<td><a href="#corelog">CoreLog</a></td>
<td>Error logging</td>
</tr>
<tr>
<td><code>$this->core->config</code></td>
<td><a href="#coreconfig">CoreConfig</a></td>
<td>Configuration management</td>
</tr>
<tr>
<td><code>$this->core->session</code></td>
<td><a href="#coresession">CoreSession</a></td>
<td>Session management</td>
</tr>
<tr>
<td><code>$this->core->security</code></td>
<td><a href="#coresecurity">CoreSecurity</a></td>
<td>Security features</td>
</tr>
<tr>
<td><code>$this->core->cache</code></td>
<td><a href="#corecache">CoreCache</a></td>
<td>Caching system</td>
</tr>
<tr>
<td><code>$this->core->request</code></td>
<td><a href="#corerequest">CoreRequest</a></td>
<td>HTTP request handling</td>
</tr>
<tr>
<td><code>$this->core->user</code></td>
<td><a href="#coreuser">CoreUser</a></td>
<td>User management</td>
</tr>
<tr>
<td><code>$this->core->localization</code></td>
<td><a href="#corelocalization">CoreLocalization</a></td>
<td>Localization/i18n</td>
</tr>
<tr>
<td><code>$this->core->model</code></td>
<td><a href="#coremodel">CoreModel</a></td>
<td>Data models</td>
</tr>
</tbody>
</table>

<p>---</p>

<h2>Main Methods</h2>

<h3>loadClass()</h3>

<pre><code class="language-php">public function loadClass($class, $params = null): object|null
</code></pre>

<p>Loads and instantiates a CloudFramework class.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$class</code> (string): Class name</li>
<li><code>$params</code> (mixed): Parameters to pass to the class constructor</li>
</ul>

<strong>Returns:</strong> Instance of the class, or <code>null</code> if not found

<strong>Example:</strong>
<pre><code class="language-php">// Load DataStore
$ds = $this->core->loadClass('DataStore', ['Users']);

// Load Buckets
$buckets = $this->core->loadClass('Buckets', ['gs://my-bucket']);

// Load DataBQ
$bq = $this->core->loadClass('DataBQ', ['my_dataset']);

// Load CloudSQL
$sql = $this->core->loadClass('CloudSQL', [
    'host',
    'user',
    'password',
    'database'
]);

// Load Email
$email = $this->core->loadClass('Email');

// Load custom class from /class directory
$myClass = $this->core->loadClass('MyCustomClass', ['param1', 'param2']);
</code></pre>

<strong>Class Loading Paths:</strong>
<p>1. <code>vendor/cloudframework-io/backend-core-php8/src/class/{Class}.php</code> 2. <code>./class/{Class}.php</code> (your project) 3. Custom path from <code>core.api.extra_path</code> config</p>

<p>---</p>

<h3>jsonEncode()</h3>

<pre><code class="language-php">public function jsonEncode($input, $options = null): string|false
</code></pre>

<p>Encodes data to JSON with UTF-8 support.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$input</code> (mixed): Data to encode</li>
<li><code>$options</code> (int): JSON encode options</li>
</ul>

<strong>Returns:</strong> JSON string, or <code>false</code> on error

<strong>Example:</strong>
<pre><code class="language-php">$json = $this->core->jsonEncode(['name' => 'John', 'age' => 30]);
// Returns: {"name":"John","age":30}

// With custom options
$json = $this->core->jsonEncode($data, JSON_PRETTY_PRINT);
</code></pre>

<p>---</p>

<h3>jsonDecode()</h3>

<pre><code class="language-php">public function jsonDecode($input): mixed
</code></pre>

<p>Decodes JSON string to PHP array/object.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$input</code> (string): JSON string</li>
</ul>

<strong>Returns:</strong> Decoded data

<strong>Example:</strong>
<pre><code class="language-php">$data = $this->core->jsonDecode('{"name":"John","age":30}');
// Returns: ['name' => 'John', 'age' => 30]
</code></pre>

<p>---</p>

<h3>getCloudFrameworkAPIBaseURL()</h3>

<pre><code class="language-php">public function getCloudFrameworkAPIBaseURL(): string
</code></pre>

<p>Gets the base URL for CloudFramework API services.</p>

<strong>Returns:</strong> Current CloudFramework API base URL

<strong>Example:</strong>
<pre><code class="language-php">$apiUrl = $this->core->getCloudFrameworkAPIBaseURL();
// Returns: 'https://api.cloudframework.io' (default)

// Use in API calls
$url = $this->core->getCloudFrameworkAPIBaseURL() . '/core/secrets/my-platform';
</code></pre>

<p>---</p>

<h3>setCloudFrameworkAPIBaseURL()</h3>

<pre><code class="language-php">public function setCloudFrameworkAPIBaseURL(string $url): string
</code></pre>

<p>Sets the base URL for CloudFramework API services.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$url</code> (string): New base URL (must be a valid URL starting with 'http')</li>
</ul>

<strong>Returns:</strong> The current CloudFramework API base URL

<strong>Example:</strong>
<pre><code class="language-php">// Set custom API URL (e.g., for testing or private instance)
$this->core->setCloudFrameworkAPIBaseURL('https://custom-api.mycompany.com');

// Invalid URL won't change the setting
$this->core->setCloudFrameworkAPIBaseURL('invalid-url');
// Returns original URL, doesn't change it

// Use case: Override for development
if($this->core->is->development()) {
    $this->core->setCloudFrameworkAPIBaseURL('http://localhost:8080/api');
}
</code></pre>

<p>---</p>

<h3>verifyModelStructureForObject()</h3>

<pre><code class="language-php">public function verifyModelStructureForObject(string $object, ?array $options = []): false|string
</code></pre>

<p>Verifies and returns the model structure for a given object, supporting extended CloudFramework Objects (CFOs).</p>

<strong>Parameters:</strong>
<ul>
<li><code>$object</code> (string): Object name to verify</li>
<li><code>$options</code> (array): Optional configuration options</li>
</ul>

<strong>Returns:</strong> Model structure as string, or <code>false</code> if verification fails

<strong>Example:</strong>
<pre><code class="language-php">// Verify model structure exists
$modelStructure = $this->core->verifyModelStructureForObject('Users');
if($modelStructure) {
    // Model is valid, use it
    $ds = $this->core->loadClass('DataStore', [$modelStructure]);
} else {
    // Model not found or invalid
    $this->core->errors->add('Invalid model structure for Users');
}

// With options for extended CFOs
$modelStructure = $this->core->verifyModelStructureForObject('CustomObject', [
    'allow_extended' => true,
    'merge_cfo' => true
]);
</code></pre>

<strong>Use Case:</strong>
<p>This method is particularly useful when working with CloudFramework Objects that may have extensions or when you need to validate model structure before loading DataStore or other model-dependent classes.</p>

<p>---</p>

<h2>CorePerformance</h2>

<strong>Access:</strong> <code>$this->core->__p</code>

Monitors performance and execution time.

<h3>add()</h3>

<pre><code class="language-php">$this->core->__p->add($title, $data = '', $type = '');
</code></pre>

<p>Adds a performance marker.</p>

<strong>Example:</strong>
<pre><code class="language-php">$this->core->__p->add('Start processing', '', 'note');
// ... your code ...
$this->core->__p->add('End processing', '', 'endnote');
</code></pre>

<p>---</p>

<h2>CoreIs</h2>

<strong>Access:</strong> <code>$this->core->is</code>

Detects environment and execution context.

<h3>Methods</h3>

<pre><code class="language-php">// Check environment
if($this->core->is->development()) {
    echo "Running in development mode";
}

if($this->core->is->production()) {
    echo "Running in production";
}

// Check execution context
if($this->core->is->terminal()) {
    echo "Running from terminal";
}

// Check server
if($this->core->is->localEnvironment()) {
    echo "Running on localhost";
}

// Check GCP environment
if($this->core->is->gae()) {
    echo "Running on Google App Engine";
}
</code></pre>

<p>---</p>

<h2>CoreSystem</h2>

<strong>Access:</strong> <code>$this->core->system</code>

Provides system and environment information.

<h3>Properties</h3>

<pre><code class="language-php">// Root path
echo $this->core->system->root_path;
// /var/www/html

// App path
echo $this->core->system->app_path;
// /var/www/html/app

// URL information
echo $this->core->system->url['host'];
echo $this->core->system->url['protocol'];
echo $this->core->system->url['url'];
echo $this->core->system->url['uri'];

// Server information
echo $this->core->system->os;
echo $this->core->system->ip;

// Time zone
echo $this->core->system->time_zone[0];
// UTC
</code></pre>

<p>---</p>

<h2>CoreLog</h2>

<strong>Access:</strong> <code>$this->core->logs</code> and <code>$this->core->errors</code>

Logging system for application messages and errors.

<h3>add()</h3>

<pre><code class="language-php">$this->core->logs->add($message, $category = '', $type = 'info');
</code></pre>

<p>Adds a log entry.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$message</code> (string|array): Log message</li>
<li><code>$category</code> (string): Log category</li>
<li><code>$type</code> (string): Log type (info, warning, error)</li>
</ul>

<strong>Example:</strong>
<pre><code class="language-php">// Simple log
$this->core->logs->add('User logged in');

// Log with category
$this->core->logs->add('Payment processed', 'payments');

// Log with type
$this->core->logs->add('Database connection failed', 'database', 'error');

// Error logging
$this->core->errors->add('Critical error occurred', 'system', 'error');

// Log arrays
$this->core->logs->add(['user_id' => 123, 'action' => 'login'], 'auth');
</code></pre>

<h3>get()</h3>

<pre><code class="language-php">$logs = $this->core->logs->get();
</code></pre>

<p>Gets all log entries.</p>

<strong>Example:</strong>
<pre><code class="language-php">$logs = $this->core->logs->get();
foreach($logs as $log) {
    echo $log . "\n";
}
</code></pre>

<p>---</p>

<h2>CoreConfig</h2>

<strong>Access:</strong> <code>$this->core->config</code>

Configuration management system.

<h3>get()</h3>

<pre><code class="language-php">$value = $this->core->config->get($key, $default = null);
</code></pre>

<p>Gets a configuration value.</p>

<strong>Example:</strong>
<pre><code class="language-php">// Simple config
$projectId = $this->core->config->get('core.gcp.project_id');

// With default
$timeout = $this->core->config->get('api.timeout', 30);

// Nested config
$dbHost = $this->core->config->get('database.host');
$cacheEnabled = $this->core->config->get('cache.enabled');
</code></pre>

<h3>set()</h3>

<pre><code class="language-php">$this->core->config->set($key, $value);
</code></pre>

<p>Sets a configuration value.</p>

<strong>Example:</strong>
<pre><code class="language-php">$this->core->config->set('api.timeout', 60);
$this->core->config->set('custom.setting', 'value');
</code></pre>

<h3>readConfigJSONFile()</h3>

<pre><code class="language-php">$this->core->config->readConfigJSONFile($file_path);
</code></pre>

<p>Loads configuration from a JSON file.</p>

<strong>Example:</strong>
<pre><code class="language-php">// Load custom config
$this->core->config->readConfigJSONFile('/path/to/config.json');

// Automatically loaded files:
// - config.json (main)
// - local_config.json (development)
// - local_script.json (scripts in development)
</code></pre>

<p>---</p>

<h2>CoreSession</h2>

<strong>Access:</strong> <code>$this->core->session</code>

Session management system.

<h3>init()</h3>

<pre><code class="language-php">$this->core->session->init($id = 'CloudFramework');
</code></pre>

<p>Initializes a session.</p>

<h3>set()</h3>

<pre><code class="language-php">$this->core->session->set($key, $value);
</code></pre>

<p>Sets a session value.</p>

<strong>Example:</strong>
<pre><code class="language-php">$this->core->session->set('user_id', 123);
$this->core->session->set('cart', $cartData);
</code></pre>

<h3>get()</h3>

<pre><code class="language-php">$value = $this->core->session->get($key, $default = null);
</code></pre>

<p>Gets a session value.</p>

<strong>Example:</strong>
<pre><code class="language-php">$userId = $this->core->session->get('user_id');
$cart = $this->core->session->get('cart', []);
</code></pre>

<h3>delete()</h3>

<pre><code class="language-php">$this->core->session->delete($key);
</code></pre>

<p>Deletes a session value.</p>

<strong>Example:</strong>
<pre><code class="language-php">$this->core->session->delete('cart');
</code></pre>

<p>---</p>

<h2>CoreSecurity</h2>

<strong>Access:</strong> <code>$this->core->security</code>

Security and authentication features.

<h3>checkUserIP()</h3>

<pre><code class="language-php">$allowed = $this->core->security->checkUserIP($ips);
</code></pre>

<p>Checks if user IP is in allowed list.</p>

<h3>existBasicAuth()</h3>

<pre><code class="language-php">if($this->core->security->existBasicAuth()) {
    $user = $_SERVER['PHP_AUTH_USER'];
    $pass = $_SERVER['PHP_AUTH_PW'];
}
</code></pre>

<p>Checks if HTTP Basic Auth credentials exist.</p>

<h3>encrypt()</h3>

<pre><code class="language-php">$encrypted = $this->core->security->encrypt($data, $key);
</code></pre>

<p>Encrypts data.</p>

<h3>decrypt()</h3>

<pre><code class="language-php">$decrypted = $this->core->security->decrypt($encrypted, $key);
</code></pre>

<p>Decrypts data.</p>

<strong>Example:</strong>
<pre><code class="language-php">// Encrypt sensitive data
$encrypted = $this->core->security->encrypt('secret data', 'encryption-key');

// Decrypt
$decrypted = $this->core->security->decrypt($encrypted, 'encryption-key');
</code></pre>

<p>---</p>

<h2>CoreCache</h2>

<strong>Access:</strong> <code>$this->core->cache</code>

Caching system (supports file cache, memory, and Datastore).

<h3>set()</h3>

<pre><code class="language-php">$this->core->cache->set($key, $value, $ttl = 0);
</code></pre>

<p>Sets a cache value.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$key</code> (string): Cache key</li>
<li><code>$value</code> (mixed): Value to cache</li>
<li><code>$ttl</code> (int): Time to live in seconds (0 = no expiration)</li>
</ul>

<strong>Example:</strong>
<pre><code class="language-php">// Cache for 1 hour
$this->core->cache->set('users_list', $users, 3600);

// Cache indefinitely
$this->core->cache->set('config', $config);

// Cache complex data
$this->core->cache->set('api_response', ['data' => $data, 'timestamp' => time()], 300);
</code></pre>

<h3>get()</h3>

<pre><code class="language-php">$value = $this->core->cache->get($key);
</code></pre>

<p>Gets a cache value.</p>

<strong>Example:</strong>
<pre><code class="language-php">$users = $this->core->cache->get('users_list');

if($users === null) {
    // Cache miss - fetch from database
    $users = $this->fetchUsersFromDB();
    $this->core->cache->set('users_list', $users, 3600);
}
</code></pre>

<h3>delete()</h3>

<pre><code class="language-php">$this->core->cache->delete($key);
</code></pre>

<p>Deletes a cache entry.</p>

<strong>Example:</strong>
<pre><code class="language-php">$this->core->cache->delete('users_list');
</code></pre>

<h3>flush()</h3>

<pre><code class="language-php">$this->core->cache->flush();
</code></pre>

<p>Clears all cache entries.</p>

<p>---</p>

<h2>CoreRequest</h2>

<strong>Access:</strong> <code>$this->core->request</code>

HTTP request utilities.

<h3>get()</h3>

<pre><code class="language-php">$data = $this->core->request->get($url, $options = []);
</code></pre>

<p>Performs a GET request.</p>

<strong>Example:</strong>
<pre><code class="language-php">$response = $this->core->request->get('https://api.example.com/data');
$json = json_decode($response, true);

// With headers
$response = $this->core->request->get('https://api.example.com/data', [
    'headers' => ['Authorization' => 'Bearer token123']
]);
</code></pre>

<h3>post()</h3>

<pre><code class="language-php">$data = $this->core->request->post($url, $data, $options = []);
</code></pre>

<p>Performs a POST request.</p>

<strong>Example:</strong>
<pre><code class="language-php">$response = $this->core->request->post('https://api.example.com/users', [
    'name' => 'John Doe',
    'email' => 'john@example.com'
]);
</code></pre>

<p>---</p>

<h2>CoreUser</h2>

<strong>Access:</strong> <code>$this->core->user</code>

User management and authentication.

<h3>setUser()</h3>

<pre><code class="language-php">$this->core->user->setUser($userData);
</code></pre>

<p>Sets current user data.</p>

<h3>getUser()</h3>

<pre><code class="language-php">$user = $this->core->user->getUser();
</code></pre>

<p>Gets current user data.</p>

<strong>Example:</strong>
<pre><code class="language-php">// Set user after login
$this->core->user->setUser([
    'id' => 123,
    'name' => 'John Doe',
    'email' => 'john@example.com',
    'role' => 'admin'
]);

// Get user in another endpoint
$user = $this->core->user->getUser();
if($user && $user['role'] === 'admin') {
    // Admin access
}
</code></pre>

<p>---</p>

<h2>CoreLocalization</h2>

<strong>Access:</strong> <code>$this->core->localization</code>

Localization and internationalization.

<h3>setLang()</h3>

<pre><code class="language-php">$this->core->localization->setLang($lang);
</code></pre>

<p>Sets the current language.</p>

<h3>getLang()</h3>

<pre><code class="language-php">$lang = $this->core->localization->getLang();
</code></pre>

<p>Gets the current language.</p>

<strong>Example:</strong>
<pre><code class="language-php">// Set language
$this->core->localization->setLang('es');

// Get translated string
$message = $this->core->localization->get('welcome_message');
</code></pre>

<p>---</p>

<h2>Complete Example</h2>

<pre><code class="language-php"><?php
class API extends RESTful
{
    function main()
    {
        // Log API call
        $this->core->logs->add('API endpoint accessed', 'api');

        // Check environment
        if($this->core->is->development()) {
            $this->core->logs->add('Running in development mode');
        }

        // Get configuration
        $timeout = $this->core->config->get('api.timeout', 30);
        $projectId = $this->core->config->get('core.gcp.project_id');

        // Check cache
        $cacheKey = 'users_' . $this->formParams['filter'] ?? 'all';
        $users = $this->core->cache->get($cacheKey);

        if($users === null) {
            // Cache miss - fetch from database
            $ds = $this->core->loadClass('DataStore', ['Users']);
            $users = $ds->fetchAll();

            // Cache for 5 minutes
            $this->core->cache->set($cacheKey, $users, 300);
        }

        // Check user session
        $userId = $this->core->session->get('user_id');
        if(!$userId) {
            return $this->setErrorFromCodelib('security-error');
        }

        // Log performance
        $this->core->__p->add('Data fetched', count($users), 'note');

        // Return data
        $this->addReturnData([
            'users' => $users,
            'cached' => $users !== null,
            'environment' => $this->core->is->development() ? 'dev' : 'prod'
        ]);
    }
}
</code></pre>

<p>---</p>

<h2>See Also</h2>

<ul>
<li><a href="../guides/getting-started.html">Getting Started Guide</a></li>
<li><a href="../guides/api-development.html">API Development Guide</a></li>
<li><a href="RESTful.html">RESTful Class</a></li>
<li><a href="../guides/configuration.html">Configuration Guide</a></li>
</ul>

        </main>
    </div>

    <script src="../js/main.js"></script>
</body>
</html>