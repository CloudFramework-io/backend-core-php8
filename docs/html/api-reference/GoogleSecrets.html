<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoogleSecrets Class - CloudFramework Backend Core PHP8</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo">
                <h2>CloudFramework</h2>
                <p>Backend Core PHP8</p>
            </div>
            <nav>
                <a href="../index.html">Home</a>
                <h3>Core Classes</h3>
                <a href="Core7.html">Core7</a>
                <a href="RESTful.html">RESTful</a>
                <a href="Scripts2020.html">Scripts2020</a>
                <h3>Configuration & Security</h3>
                <a href="CoreConfig.html">CoreConfig</a>
                <a href="CoreCache.html">CoreCache</a>
                <a href="CoreSession.html">CoreSession</a>
                <a href="CoreSecurity.html">CoreSecurity</a>
                <h3>Data Storage</h3>
                <a href="DataStore.html">DataStore</a>
                <a href="Buckets.html">Buckets</a>
                <a href="DataBQ.html">DataBQ</a>
                <a href="CloudSQL.html">CloudSQL</a>
                <a href="DataSQL.html">DataSQL</a>
                <a href="DataMongoDB.html">DataMongoDB</a>
                <h3>Utilities</h3>
                <a href="Email.html">Email</a>
                <a href="DataValidation.html">DataValidation</a>
                <a href="WorkFlows.html">WorkFlows</a>
                <h3>GCP Integration</h3>
                <a href="GoogleSecrets.html" class="active">GoogleSecrets</a>
                <a href="PubSub.html">PubSub</a>
            </nav>
        </aside>
        <main class="content">
<h1>GoogleSecrets Class</h1>

<h2>Overview</h2>

<p>The <code>GoogleSecrets</code> class provides integration with Google Cloud Secret Manager for securely storing and retrieving sensitive configuration data like API keys, passwords, and credentials.</p>

<h2>Loading the Class</h2>

<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');
</code></pre>

<h2>Properties</h2>

<p>| Property | Type | Description | |----------|------|-------------| | <code>$core</code> | Core7 | Reference to Core7 instance | | <code>$error</code> | bool | Error flag | | <code>$errorMsg</code> | array | Error messages | | <code>$client</code> | SecretManagerServiceClient | Google Secret Manager client | | <code>$projectPath</code> | string | GCP project path | | <code>$project_id</code> | string | GCP project ID |</p>

<p>---</p>

<h2>Methods</h2>

<h3>createSecret()</h3>

<pre><code class="language-php">public function createSecret($secretId): Secret
</code></pre>

<p>Creates a new secret in Google Cloud Secret Manager.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$secretId</code> (string): Secret identifier</li>
</ul>

<strong>Returns:</strong> Secret object

<strong>Example:</strong>
<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');
<p>$secret = $gs->createSecret('my-api-key'); if(!$gs->error) { // Secret created successfully }</p>
</code></pre>

<p>---</p>

<h3>getSecret()</h3>

<pre><code class="language-php">public function getSecret($secretId, $version = 'latest'): string
</code></pre>

<p>Retrieves a secret value from Google Cloud Secret Manager.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$secretId</code> (string): Secret identifier</li>
<li><code>$version</code> (string): Secret version (default: 'latest')</li>
</ul>

<strong>Returns:</strong> Secret value as string

<strong>Example:</strong>
<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');
<p>$apiKey = $gs->getSecret('stripe-api-key');</p>

<p>if($gs->error) { $this->core->logs->add('Failed to get secret: ' . json_encode($gs->errorMsg)); } else { // Use $apiKey }</p>

<p>// Get specific version $oldApiKey = $gs->getSecret('stripe-api-key', '1');</p>
</code></pre>

<p>---</p>

<h2>Configuration</h2>

<p>The class requires a GCP project ID from one of these sources (in order of priority):</p>

<p>1. <code>core.gcp.secrets.project_id</code> config variable 2. <code>core.gcp.project_id</code> config variable 3. <code>PROJECT_ID</code> environment variable</p>

<strong>config.json:</strong>
<pre><code class="language-json">{
<p>"core.gcp.secrets.project_id": "my-project-id" }</p>
</code></pre>

<p>---</p>

<h2>Common Usage Patterns</h2>

<h3>Loading API Keys</h3>

<pre><code class="language-php">class API extends RESTful
<p>{ function main() { // Load secret $gs = $this->core->loadClass('GoogleSecrets'); $apiKey = $gs->getSecret('stripe-api-key');</p>

<p>if($gs->error) { return $this->setErrorFromCodelib('config-error', 'Failed to load API key'); }</p>

<p>// Use API key \Stripe\Stripe::setApiKey($apiKey); } }</p>
</code></pre>

<h3>Loading Database Credentials</h3>

<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');
<p>$dbPassword = $gs->getSecret('database-password');</p>

<p>if(!$gs->error) { $pdo = new PDO("mysql:host=localhost;dbname=mydb", "user", $dbPassword); }</p>
</code></pre>

<h3>Caching Secrets</h3>

<pre><code class="language-php">// Cache secret for performance
<p>$apiKey = $this->core->cache->get('stripe_api_key'); if(!$apiKey) { $gs = $this->core->loadClass('GoogleSecrets'); $apiKey = $gs->getSecret('stripe-api-key');</p>

<p>if(!$gs->error) { // Cache for 1 hour $this->core->cache->set('stripe_api_key', $apiKey); } }</p>
</code></pre>

<p>---</p>

<h2>Error Handling</h2>

<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');

<p>if($gs->error) { // Error during initialization (missing project ID) $this->core->logs->add('GoogleSecrets init error: ' . json_encode($gs->errorMsg)); return; }</p>

<p>$secret = $gs->getSecret('my-secret');</p>

<p>if($gs->error) { // Error retrieving secret $this->core->logs->add('Secret retrieval error: ' . json_encode($gs->errorMsg)); }</p>
</code></pre>

<p>---</p>

<h2>See Also</h2>

<ul>
<li><a href="CoreSecurity.html">CoreSecurity Class Reference</a></li>
<li><a href="CoreConfig.html">CoreConfig Class Reference</a></li>
<li><a href="../guides/gcp-integration.html">GCP Integration Guide</a></li>
<li><a href="../guides/security.html">Security Best Practices</a></li>
</ul>

        </main>
    </div>
    <script src="../js/main.js"></script>
</body>
</html>