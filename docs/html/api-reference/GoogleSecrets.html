<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoogleSecrets Class - CloudFramework Backend Core PHP8</title>
    <meta name="description" content="GoogleSecrets Class - CloudFramework Backend Core PHP8 API Reference">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>CloudFramework Backend Core PHP8</h1>
        <span class="version">v8.4+</span>
    </header>

    <!-- Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-search">
                <input type="text" id="search-input" placeholder="Search documentation...">
            </div>

            <nav class="sidebar-nav">
                <!-- Getting Started -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Getting Started</div>
                    <ul>
                        <li><a href="../index.html" class="sidebar-nav-link">Documentation Home</a></li>
                        <li><a href="../guides/getting-started.html" class="sidebar-nav-link">Installation & Setup</a></li>
                        <li><a href="../guides/getting-started.html#quick-start" class="sidebar-nav-link">Quick Start</a></li>
                    </ul>
                </div>

                <!-- Development Guides -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Development Guides</div>
                    <ul>
                        <li><a href="../guides/api-development.html" class="sidebar-nav-link">API Development</a></li>
                        <li><a href="../guides/script-development.html" class="sidebar-nav-link">Script Development</a></li>
                        <li><a href="../guides/configuration.html" class="sidebar-nav-link">Configuration</a></li>
                        <li><a href="../guides/deployment.html" class="sidebar-nav-link">Deployment</a></li>
                    </ul>
                </div>

                <!-- GCP Integration -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">GCP Integration</div>
                    <ul>
                        <li><a href="../guides/gcp-integration.html" class="sidebar-nav-link">GCP Overview</a></li>
                        <li><a href="../guides/security.html" class="sidebar-nav-link">Security</a></li>
                        <li><a href="../guides/testing.html" class="sidebar-nav-link">Testing</a></li>
                    </ul>
                </div>

                <!-- Core Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Core Classes</div>
                    <ul>
                        <li><a href="Core7.html" class="sidebar-nav-link">Core7</a></li>
                        <li><a href="RESTful.html" class="sidebar-nav-link">RESTful</a></li>
                        <li><a href="Scripts2020.html" class="sidebar-nav-link">Scripts2020</a></li>
                    </ul>
                </div>

                <!-- Configuration Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Configuration</div>
                    <ul>
                        <li><a href="CoreConfig.html" class="sidebar-nav-link">CoreConfig</a></li>
                        <li><a href="CoreCache.html" class="sidebar-nav-link">CoreCache</a></li>
                        <li><a href="CoreSession.html" class="sidebar-nav-link">CoreSession</a></li>
                        <li><a href="CoreSecurity.html" class="sidebar-nav-link">CoreSecurity</a></li>
                    </ul>
                </div>

                <!-- Data Access Classes -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Data Access</div>
                    <ul>
                        <li><a href="DataStore.html" class="sidebar-nav-link">DataStore</a></li>
                        <li><a href="Buckets.html" class="sidebar-nav-link">Buckets</a></li>
                        <li><a href="DataBQ.html" class="sidebar-nav-link">DataBQ</a></li>
                        <li><a href="CloudSQL.html" class="sidebar-nav-link">CloudSQL</a></li>
                        <li><a href="DataSQL.html" class="sidebar-nav-link">DataSQL</a></li>
                        <li><a href="DataMongoDB.html" class="sidebar-nav-link">DataMongoDB</a></li>
                    </ul>
                </div>

                <!-- Utilities -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Utilities</div>
                    <ul>
                        <li><a href="Email.html" class="sidebar-nav-link">Email</a></li>
                        <li><a href="DataValidation.html" class="sidebar-nav-link">DataValidation</a></li>
                        <li><a href="WorkFlows.html" class="sidebar-nav-link">WorkFlows</a></li>
                        <li><a href="GoogleSecrets.html" class="sidebar-nav-link active">GoogleSecrets</a></li>
                        <li><a href="PubSub.html" class="sidebar-nav-link">PubSub</a></li>
                    </ul>
                </div>

                <!-- Examples -->
                <div class="sidebar-nav-section">
                    <div class="sidebar-nav-title">Examples</div>
                    <ul>
                        <li><a href="../examples/api-examples.html" class="sidebar-nav-link">API Examples</a></li>
                        <li><a href="../examples/script-examples.html" class="sidebar-nav-link">Script Examples</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
<h1>GoogleSecrets Class</h1>

<h2>Overview</h2>

The <code>GoogleSecrets</code> class provides integration with Google Cloud Secret Manager for securely storing and retrieving sensitive configuration data like API keys, passwords, and credentials.

<h2>Loading the Class</h2>

<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');
</code></pre>

<h2>Properties</h2>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$core</code></td>
<td>Core7</td>
<td>Reference to Core7 instance</td>
</tr>
<tr>
<td><code>$error</code></td>
<td>bool</td>
<td>Error flag</td>
</tr>
<tr>
<td><code>$errorMsg</code></td>
<td>array</td>
<td>Error messages</td>
</tr>
<tr>
<td><code>$client</code></td>
<td>SecretManagerServiceClient</td>
<td>Google Secret Manager client</td>
</tr>
<tr>
<td><code>$projectPath</code></td>
<td>string</td>
<td>GCP project path</td>
</tr>
<tr>
<td><code>$project_id</code></td>
<td>string</td>
<td>GCP project ID</td>
</tr>
</tbody>
</table>

<p>---</p>

<h2>Methods</h2>

<h3>createSecret()</h3>

<pre><code class="language-php">public function createSecret($secretId): Secret
</code></pre>

<p>Creates a new secret in Google Cloud Secret Manager.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$secretId</code> (string): Secret identifier</li>
</ul>

<strong>Returns:</strong> Secret object

<strong>Example:</strong>
<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');
$secret = $gs->createSecret('my-api-key');
if(!$gs->error) {
    // Secret created successfully
}
</code></pre>

<p>---</p>

<h3>getSecret()</h3>

<pre><code class="language-php">public function getSecret($secretId, $version = 'latest'): string
</code></pre>

<p>Retrieves a secret value from Google Cloud Secret Manager.</p>

<strong>Parameters:</strong>
<ul>
<li><code>$secretId</code> (string): Secret identifier</li>
<li><code>$version</code> (string): Secret version (default: 'latest')</li>
</ul>

<strong>Returns:</strong> Secret value as string

<strong>Example:</strong>
<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');
$apiKey = $gs->getSecret('stripe-api-key');

if($gs->error) {
    $this->core->logs->add('Failed to get secret: ' . json_encode($gs->errorMsg));
} else {
    // Use $apiKey
}

// Get specific version
$oldApiKey = $gs->getSecret('stripe-api-key', '1');
</code></pre>

<p>---</p>

<h2>Configuration</h2>

The class requires a GCP project ID from one of these sources (in order of priority):

1. <code>core.gcp.secrets.project_id</code> config variable
2. <code>core.gcp.project_id</code> config variable
3. <code>PROJECT_ID</code> environment variable

<strong>config.json:</strong>
<pre><code class="language-json">{
  "core.gcp.secrets.project_id": "my-project-id"
}
</code></pre>

<p>---</p>

<h2>Common Usage Patterns</h2>

<h3>Loading API Keys</h3>

<pre><code class="language-php">class API extends RESTful
{
    function main()
    {
        // Load secret
        $gs = $this->core->loadClass('GoogleSecrets');
        $apiKey = $gs->getSecret('stripe-api-key');

        if($gs->error) {
            return $this->setErrorFromCodelib('config-error', 'Failed to load API key');
        }

        // Use API key
        \Stripe\Stripe::setApiKey($apiKey);
    }
}
</code></pre>

<h3>Loading Database Credentials</h3>

<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');
$dbPassword = $gs->getSecret('database-password');

if(!$gs->error) {
    $pdo = new PDO("mysql:host=localhost;dbname=mydb", "user", $dbPassword);
}
</code></pre>

<h3>Caching Secrets</h3>

<pre><code class="language-php">// Cache secret for performance
$apiKey = $this->core->cache->get('stripe_api_key');
if(!$apiKey) {
    $gs = $this->core->loadClass('GoogleSecrets');
    $apiKey = $gs->getSecret('stripe-api-key');

    if(!$gs->error) {
        // Cache for 1 hour
        $this->core->cache->set('stripe_api_key', $apiKey);
    }
}
</code></pre>

<p>---</p>

<h2>Error Handling</h2>

<pre><code class="language-php">$gs = $this->core->loadClass('GoogleSecrets');

if($gs->error) {
    // Error during initialization (missing project ID)
    $this->core->logs->add('GoogleSecrets init error: ' . json_encode($gs->errorMsg));
    return;
}

$secret = $gs->getSecret('my-secret');

if($gs->error) {
    // Error retrieving secret
    $this->core->logs->add('Secret retrieval error: ' . json_encode($gs->errorMsg));
}
</code></pre>

<p>---</p>

<h2>See Also</h2>

<ul>
<li><a href="CoreSecurity.html">CoreSecurity Class Reference</a></li>
<li><a href="CoreConfig.html">CoreConfig Class Reference</a></li>
<li><a href="../guides/gcp-integration.html">GCP Integration Guide</a></li>
<li><a href="../guides/security.html">Security Best Practices</a></li>
</ul>

        </main>
    </div>

    <script src="../js/main.js"></script>
</body>
</html>